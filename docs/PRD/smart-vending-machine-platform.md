# PRD: 智能售货机平台

## 🎯 产品目标
**用户价值**: 为消费者提供便捷的饮品购买体验，为设备运营商提供高效的设备管理和盈利工具
**业务价值**: 构建智能售货机生态系统，实现设备管理自动化、支付流程便捷化、运营数据可视化
**成功指标**: 
- 用户下单成功率 >95%
- 支付成功率 >98%
- 设备在线率 >90%
- 用户留存率(7天) >60%

## 👥 目标用户
**主要用户**: 
- **消费者**: 需要便捷购买饮品的用户（办公楼、学校、商场等场景）
- **设备运营商**: 售货机投放和运营管理人员

**次要用户**: 
- **设备维护人员**: 负责设备补货和维护
- **平台管理员**: 系统运营和数据分析人员

## 📋 功能需求

### 核心功能

#### 1. 用户端功能 (消费者)
- **用户注册/登录**: 微信一键登录，自动获取用户基本信息
- **商品浏览**: 查看售货机可用商品、价格、库存状态
- **下单购买**: 选择商品(含/不含杯)，生成订单
- **支付功能**: 支持微信支付，订单状态实时更新
- **订单管理**: 查看历史订单、支付状态、制作进度
- **退款申请**: 制作失败自动退款，异常情况手动退款

#### 2. 运营端功能 (设备运营商)
- **设备管理**: 售货机注册、状态监控、上下线管理
- **商品管理**: 商品信息维护、价格设置、库存管理
- **订单监控**: 实时订单跟踪、异常订单处理
- **财务报表**: 销售数据统计、收入分析、成本管控
- **设备维护**: 故障报警、补货提醒、维护记录

#### 3. 设备集成功能
- **设备通信**: MQTT协议与售货机硬件通信
- **制作控制**: 远程控制饮品制作流程
- **状态同步**: 实时同步设备状态、库存变化
- **故障监测**: 设备异常检测和报警推送

### 不做范围 (V1.0)
- 积分系统和会员等级
- 社交功能和用户评价
- 复杂的营销活动和优惠券
- 多语言支持
- 第三方支付渠道(仅支持微信支付)

## 🎨 交互设计
**用户流程**: 
1. 扫码/搜索发现售货机 → 2. 浏览商品列表 → 3. 选择商品和杯型 → 4. 确认订单和价格 → 5. 微信支付 → 6. 等待制作完成 → 7. 取货

**关键界面**: 
- 商品列表页: 展示可用商品、价格、库存状态
- 订单确认页: 商品详情、价格明细、支付按钮
- 制作进度页: 实时显示制作状态和预计完成时间
- 订单历史页: 历史购买记录和订单状态

## 🏗️ 技术架构

### 后端架构 (Go + Gin)
```
├── handlers/          # API控制器
│   ├── member.go     # 用户管理接口
│   ├── machine.go    # 设备管理接口
│   ├── product.go    # 商品管理接口
│   ├── order.go      # 订单管理接口
│   └── payment.go    # 支付回调接口
├── services/          # 业务逻辑层
├── repositories/      # 数据访问层
├── models/           # 数据模型
└── contracts/        # API契约
```

### 数据库设计 (MySQL)
**核心表结构**:
- `members`: 用户信息表
- `machines`: 售货机设备表
- `products`: 商品基础信息表
- `machine_products`: 设备商品关联表(价格、库存)
- `orders`: 订单表
- `machine_owners`: 设备运营商表

### 外部集成
- **微信支付**: 统一下单、支付回调、退款接口
- **MQTT服务**: 与售货机硬件实时通信
- **监控系统**: OpenTelemetry链路追踪

## 📊 验收标准

### 功能验收
- [ ] 用户可以通过微信登录访问系统
- [ ] 用户可以浏览售货机商品并查看实时库存
- [ ] 用户可以下单并完成微信支付
- [ ] 设备收到订单后能正确执行制作流程
- [ ] 制作完成/失败状态能正确更新到订单
- [ ] 运营商可以管理设备和查看销售数据
- [ ] 支付异常和制作失败能自动触发退款

### 性能标准
- [ ] API响应时间 <500ms (95%请求)
- [ ] 支付接口响应时间 <2s
- [ ] 设备状态同步延迟 <3s
- [ ] 系统可支持并发用户数 >1000

### 可用性标准
- [ ] 系统可用性 >99.5%
- [ ] 支付成功率 >98%
- [ ] 设备通信成功率 >95%

## 🧪 验证计划

### 关键指标跟踪
- **业务指标**: 日活用户数、订单转化率、客单价、设备利用率
- **技术指标**: API成功率、响应时间、错误率、设备在线率
- **用户体验**: 支付成功率、制作成功率、用户投诉率

### A/B测试计划
- **商品展示**: 测试不同商品排序策略对下单率的影响
- **价格策略**: 测试含杯/不含杯价格差异对用户选择的影响
- **支付流程**: 测试一步支付vs确认支付对支付成功率的影响

### 成功阈值
- 7天后用户留存率 >60%
- 用户人均订单数 >2单/周
- 设备日均销售额提升 >30%

## 📈 运营数据需求

### 实时监控大屏
- 在线设备数量和分布
- 实时订单数和销售额
- 异常订单和设备故障统计
- 热销商品排行榜

### 运营分析报表
- 日/周/月销售趋势分析
- 设备效率和盈利能力分析
- 用户行为和偏好分析
- 库存周转和补货建议

---

**PRD版本**: v1.0  
**创建时间**: 2025-08-11  
**产品经理**: Product Agent  
**预估开发周期**: 6-8周